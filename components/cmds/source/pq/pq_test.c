#include <fcntl.h>
#include <unistd.h>
#include <kernel/vfs.h>
#include <stdio.h>
#include <kernel/io.h>
#include <getopt.h>
#include <malloc.h>

#include <kernel/lib/console.h>
#include <kernel/completion.h>
#include <sys/ioctl.h>
#include <sys/types.h>
#include <hcuapi/common.h>
#include <hcuapi/pq.h>

static int pq_fd = -1;

// Values
static struct pq_settings pqReg = {
    // // VERSION
    // "1.0.0", "20220628093552",
    // // COMMON
    // true,
    // // COLOR DEVICE
    // 0.640000, 0.330000, 0.300000, 0.600000, 0.150000, 0.060000, 0.312700, 0.329000,

    "dummy",
    // 0x00
    true, true, true, true, true, true,
    // 0x10
    true, 21, 57,
    // 0x20
    1024, 0,
    // 0x24
    0, 0,
    // 0x28
    1024, 0,
    // 0x2c
    0, 0,
    // 0x30
    1024,
    // 0x34
    128, 128, 128,
    // 0x38
    0, 0, 0,
    // 0x40
    true, true, 6, 8, 29,
   
    // 0x60
    { -3, 0, 4, 7, 11, 14, 18, 21, 25, 30, 35, 40, 46, 52, 58, 65, 72, 80, 88, 97, 106, 115, 125, 136, 147, 158, 170, 182, 195, 208, 222, 236, 250, 266, 281, 297, 314, 331, 349, 367, 385, 405, 424, 444, 465, 486, 508, 530, 553, 576, 600, 625, 650, 675, 701, 728, 755, 782, 810, 839, 868, 898, 929, 959, 991, 1023, 1056 },
    { -3, 0, 4, 7, 11, 14, 18, 21, 25, 30, 35, 40, 46, 52, 58, 65, 72, 80, 88, 97, 106, 115, 125, 136, 147, 158, 170, 182, 195, 208, 222, 236, 250, 266, 281, 297, 314, 331, 349, 367, 385, 405, 424, 444, 465, 486, 508, 530, 553, 576, 600, 625, 650, 675, 701, 728, 755, 782, 810, 839, 868, 898, 929, 959, 991, 1023, 1056 },
    { -3, 0, 4, 7, 11, 14, 18, 21, 25, 30, 35, 40, 46, 52, 58, 65, 72, 80, 88, 97, 106, 115, 125, 136, 147, 158, 170, 182, 195, 208, 222, 236, 250, 266, 281, 297, 314, 331, 349, 367, 385, 405, 424, 444, 465, 486, 508, 530, 553, 576, 600, 625, 650, 675, 701, 728, 755, 782, 810, 839, 868, 898, 929, 959, 991, 1023, 1056 },
    
    // 0x70
    { 0, 0, 28, 39, 46, 53, 58, 63, 68, 72, 76, 80, 84, 87, 90, 93, 96, 99, 102, 105, 107, 110, 112, 115, 117, 119, 121, 124, 126, 128, 130, 132, 134, 136, 138, 140, 141, 143, 145, 147, 149, 150, 152, 154, 155, 157, 159, 160, 162, 163, 165, 166, 168, 169, 171, 172, 174, 175, 177, 178, 179, 181, 182, 183, 185, 186, 187, 189, 190, 191, 193, 194, 195, 196, 198, 199, 200, 201, 202, 204, 205, 206, 207, 208, 209, 211, 212, 213, 214, 215, 216, 217, 218, 219, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 249, 250, 251, 252, 253, 254, 255, 256 },
    { 0, 0, 28, 39, 46, 53, 58, 63, 68, 72, 76, 80, 84, 87, 90, 93, 96, 99, 102, 105, 107, 110, 112, 115, 117, 119, 121, 124, 126, 128, 130, 132, 134, 136, 138, 140, 141, 143, 145, 147, 149, 150, 152, 154, 155, 157, 159, 160, 162, 163, 165, 166, 168, 169, 171, 172, 174, 175, 177, 178, 179, 181, 182, 183, 185, 186, 187, 189, 190, 191, 193, 194, 195, 196, 198, 199, 200, 201, 202, 204, 205, 206, 207, 208, 209, 211, 212, 213, 214, 215, 216, 217, 218, 219, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 249, 250, 251, 252, 253, 254, 255, 256 },
    { 0, 0, 28, 39, 46, 53, 58, 63, 68, 72, 76, 80, 84, 87, 90, 93, 96, 99, 102, 105, 107, 110, 112, 115, 117, 119, 121, 124, 126, 128, 130, 132, 134, 136, 138, 140, 141, 143, 145, 147, 149, 150, 152, 154, 155, 157, 159, 160, 162, 163, 165, 166, 168, 169, 171, 172, 174, 175, 177, 178, 179, 181, 182, 183, 185, 186, 187, 189, 190, 191, 193, 194, 195, 196, 198, 199, 200, 201, 202, 204, 205, 206, 207, 208, 209, 211, 212, 213, 214, 215, 216, 217, 218, 219, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 249, 250, 251, 252, 253, 254, 255, 256 }
};


static int pq_start(int argc , char *argv[])
{
    pq_fd = open("/dev/pq" , O_WRONLY);
    if(pq_fd < 0)
    {
        return -1;
    }
    printf("pq_start\n");

    ioctl(pq_fd , PQ_SET_PARAM,&pqReg);
    ioctl(pq_fd , PQ_START);

    return 0;
}

static int pq_stop(int argc , char *argv[])
{
    printf("pq_stop\n");
    if(pq_fd >= 0)
    {

        ioctl(pq_fd , PQ_STOP);
        close(pq_fd);
        pq_fd = -1;
        return 0;
    }
    else
    {
        return -1;
    }
}

CONSOLE_CMD(pq_start , NULL , pq_start , CONSOLE_CMD_MODE_SELF , "pq_test")
CONSOLE_CMD(pq_stop , NULL , pq_stop , CONSOLE_CMD_MODE_SELF , "stop pq")
