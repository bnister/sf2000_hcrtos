#include <stdlib.h>
#include <fcntl.h>
#include <sys/mman.h>
#include <unistd.h>
#include <kernel/vfs.h>
#include <stdio.h>
#include <stddef.h>
#include <string.h>
#include <kernel/io.h>
#include <getopt.h>
#include <malloc.h>
#include <kernel/lib/console.h>
#include <kernel/completion.h>
#include <sys/ioctl.h>
#include <sys/types.h>
#include <hcuapi/common.h>

#include <hcuapi/fb.h>
#include <kernel/fb.h>
#include <hcuapi/dis.h>

#define DEV_FB0 "/dev/fb0"
#define DEV_FB1 "/dev/fb1"

//#define MOUSE_DEMO 1

static int fd_fb;
static struct fb_fix_screeninfo fix; /* Current fix */
static struct fb_var_screeninfo var; /* Current var */
static uint32_t screen_size;
static uint8_t *fb_base;
static uint8_t *fb_p0;
static uint8_t *fb_p1;
static uint32_t line_width;
static uint32_t pixel_width;
#ifdef MOUSE_DEMO
static hcfb_scale_t scale_param = {1,1,1,1};//{ 1280, 720, 1920, 1080, };// to do later...
#else
static hcfb_scale_t scale_param = { 1280, 720, 1920, 1080 }; // to do later...
#endif
static int color_bit = 32;
hcfb_lefttop_pos_t pos = {0,0};

static uint8_t *bmp_buf = 0;
static uint8_t *font_buf = { 0 };

struct dis_rect {
	uint32_t x_start;
	uint32_t x_width;
	uint32_t y_start;
	uint32_t y_hight;
};

#define COLOR_BIT (32)
char bmp_array[]=
{0xFF,0xFF,0xFF,0xFF,0xFE,0xFE,0xFE,0xFF,0xFD,0xFD,0xFD,0xFF,0xFB,0xFB,0xFB,0xFF,
0xFB,0xFC,0xFF,0xFF,0xFD,0xFF,0xFF,0xFF,0xF6,0xF6,0xFA,0xFF,0xF1,0xF2,0xF4,0xFF,
0xEE,0xEF,0xF1,0xFF,0xEB,0xEC,0xEE,0xFF,0xE8,0xE9,0xEB,0xFF,0xE7,0xE9,0xEA,0xFF,
0xE8,0xE9,0xEB,0xFF,0xEA,0xEB,0xEC,0xFF,0xEC,0xED,0xEF,0xFF,0xF0,0xF1,0xF3,0xFF,
0xF3,0xF4,0xF6,0xFF,0xF5,0xF6,0xF8,0xFF,0xFD,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFC,0xFD,0xFF,0xFF,0xFD,0xFD,0xFD,0xFF,0xFE,0xFE,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFE,0xFE,0xFE,0xFF,0xFE,0xFE,0xFE,0xFF,0xFC,0xFC,0xFC,0xFF,0xFF,0xFF,0xFF,0xFF,
0xE1,0xDB,0xC1,0xFF,0xBD,0xA4,0x4B,0xFF,0xB9,0x9C,0x38,0xFF,0xBA,0x9E,0x3A,0xFF,
0xBB,0x9E,0x3A,0xFF,0xBB,0x9F,0x3B,0xFF,0xBB,0x9F,0x3B,0xFF,0xBB,0x9F,0x3B,0xFF,
0xBB,0x9F,0x3B,0xFF,0xBB,0x9F,0x3B,0xFF,0xBB,0x9F,0x3A,0xFF,0xBB,0x9E,0x3A,0xFF,
0xBA,0x9E,0x3A,0xFF,0xBA,0x9D,0x39,0xFF,0xB6,0x9B,0x37,0xFF,0xCB,0xB9,0x74,0xFF,
0xFA,0xFB,0xFD,0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0xFE,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE5,0xDC,0xB5,0xFF,
0xC3,0xA4,0x38,0xFF,0xCA,0xAF,0x4E,0xFF,0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,
0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,
0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,
0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x50,0xFF,0xC8,0xAC,0x48,0xFF,
0xC5,0xAA,0x48,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFC,0xFD,0xFB,0xFF,0xCC,0xAC,0x3E,0xFF,
0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,
0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,
0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,
0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,
0xD1,0xB3,0x4B,0xFF,0xDB,0xCA,0x85,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE6,0xDA,0xA8,0xFF,0xD2,0xB3,0x4C,0xFF,
0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,
0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,
0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x57,0xFF,0xD5,0xB8,0x58,0xFF,
0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,
0xD5,0xB8,0x57,0xFF,0xCE,0xAF,0x42,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xDE,0xC9,0x84,0xFF,0xD3,0xB8,0x55,0xFF,
0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,
0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,
0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5B,0xFF,0xD3,0xB7,0x55,0xFF,0xD2,0xB6,0x51,0xFF,
0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,
0xD5,0xBA,0x5C,0xFF,0xD1,0xB3,0x4C,0xFF,0xF5,0xF2,0xE1,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xDD,0xC9,0x83,0xFF,0xD5,0xB9,0x5B,0xFF,
0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,
0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,
0xD6,0xBB,0x60,0xFF,0xD3,0xB5,0x50,0xFF,0xEC,0xE4,0xC3,0xFF,0xED,0xE5,0xC6,0xFF,
0xD1,0xB3,0x4A,0xFF,0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,
0xD6,0xBB,0x60,0xFF,0xD3,0xB6,0x51,0xFF,0xF5,0xEF,0xDD,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xDE,0xCA,0x83,0xFF,0xD6,0xBB,0x59,0xFF,
0xD7,0xBD,0x5F,0xFF,0xD7,0xBD,0x5F,0xFF,0xD7,0xBD,0x5F,0xFF,0xD7,0xBD,0x5E,0xFF,
0xD7,0xBE,0x61,0xFF,0xD5,0xBA,0x59,0xFF,0xD7,0xBD,0x5F,0xFF,0xD7,0xBD,0x5F,0xFF,
0xD6,0xBB,0x59,0xFF,0xD9,0xC4,0x76,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xEF,0xE9,0xCF,0xFF,0xD3,0xB8,0x53,0xFF,0xD7,0xBD,0x5E,0xFF,0xD7,0xBD,0x5F,0xFF,
0xD7,0xBD,0x5F,0xFF,0xD3,0xB7,0x50,0xFF,0xF6,0xF0,0xDE,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE2,0xCC,0x86,0xFF,0xDA,0xBD,0x5E,0xFF,
0xDB,0xBF,0x64,0xFF,0xDB,0xBF,0x64,0xFF,0xDB,0xBF,0x64,0xFF,0xDB,0xBD,0x60,0xFF,
0xE1,0xCB,0x84,0xFF,0xE5,0xD7,0xA0,0xFF,0xDA,0xBB,0x5B,0xFF,0xDB,0xBE,0x63,0xFF,
0xD6,0xB7,0x53,0xFF,0xFD,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xE2,0xCF,0x8E,0xFF,0xDA,0xBD,0x5F,0xFF,0xDB,0xBF,0x64,0xFF,
0xDB,0xBF,0x64,0xFF,0xD8,0xB9,0x55,0xFF,0xF5,0xF0,0xDE,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE1,0xCD,0x87,0xFF,0xD9,0xBE,0x61,0xFF,
0xDA,0xC0,0x66,0xFF,0xDA,0xC0,0x66,0xFF,0xDA,0xC0,0x66,0xFF,0xD9,0xBE,0x60,0xFF,
0xE1,0xCD,0x88,0xFF,0xFF,0xFF,0xFF,0xFF,0xD7,0xBA,0x5B,0xFF,0xD7,0xB8,0x53,0xFF,
0xEE,0xE7,0xCA,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xEF,0xEA,0xD0,0xFF,0xD7,0xB8,0x54,0xFF,0xDA,0xC0,0x66,0xFF,0xDA,0xC0,0x66,0xFF,
0xDA,0xC0,0x66,0xFF,0xD8,0xBA,0x57,0xFF,0xF7,0xF1,0xDF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE2,0xCF,0x8A,0xFF,0xDB,0xC0,0x62,0xFF,
0xDC,0xC2,0x67,0xFF,0xDB,0xC1,0x67,0xFF,0xDB,0xC2,0x67,0xFF,0xDC,0xC0,0x63,0xFF,
0xE6,0xD5,0x98,0xFF,0xFF,0xFF,0xFF,0xFF,0xF1,0xEA,0xCB,0xFF,0xE0,0xCB,0x80,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFD,0xFF,0xFF,0xFF,
0xD9,0xBC,0x5D,0xFF,0xDB,0xC1,0x66,0xFF,0xDB,0xC1,0x67,0xFF,0xDC,0xC2,0x67,0xFF,
0xDC,0xC2,0x68,0xFF,0xD9,0xBD,0x5A,0xFF,0xF7,0xF1,0xDF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE3,0xCF,0x8B,0xFF,0xDF,0xC5,0x68,0xFF,
0xE2,0xC8,0x72,0xFF,0xE5,0xCA,0x75,0xFF,0xE6,0xCC,0x77,0xFF,0xE5,0xC9,0x6F,0xFF,
0xED,0xDF,0xAD,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFD,0xFE,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE6,0xD2,0x8D,0xFF,
0xE5,0xCA,0x70,0xFF,0xE6,0xCC,0x77,0xFF,0xE5,0xCA,0x75,0xFF,0xE2,0xC8,0x72,0xFF,
0xE0,0xC6,0x6D,0xFF,0xDA,0xBE,0x5D,0xFF,0xF7,0xF1,0xDF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE4,0xCF,0x8D,0xFF,0xE6,0xCB,0x75,0xFF,
0xE6,0xCD,0x78,0xFF,0xE6,0xCC,0x78,0xFF,0xE6,0xCC,0x77,0xFF,0xE4,0xCA,0x6F,0xFF,
0xF0,0xE5,0xBB,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF2,0xE9,0xC9,0xFF,0xE4,0xC7,0x69,0xFF,
0xE6,0xCC,0x77,0xFF,0xE6,0xCC,0x77,0xFF,0xE6,0xCC,0x78,0xFF,0xE6,0xCD,0x78,0xFF,
0xE7,0xCC,0x7A,0xFF,0xE2,0xC5,0x68,0xFF,0xF7,0xF1,0xE0,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE5,0xD0,0x8D,0xFF,0xE8,0xCE,0x76,0xFF,
0xE8,0xCE,0x7A,0xFF,0xE8,0xCE,0x7A,0xFF,0xE8,0xCE,0x7A,0xFF,0xE7,0xCB,0x70,0xFF,
0xF4,0xEA,0xCA,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFD,0xFF,0xFF,0xFF,0xE2,0xC4,0x63,0xFF,0xE8,0xCC,0x73,0xFF,
0xE8,0xCE,0x7A,0xFF,0xE8,0xCE,0x7A,0xFF,0xE8,0xCE,0x7A,0xFF,0xE8,0xCE,0x7A,0xFF,
0xE8,0xCF,0x7B,0xFF,0xE4,0xC7,0x69,0xFF,0xF7,0xF1,0xDF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE6,0xD1,0x8F,0xFF,0xEA,0xCF,0x7B,0xFF,
0xEA,0xCF,0x7E,0xFF,0xEA,0xCF,0x7E,0xFF,0xEA,0xCF,0x7E,0xFF,0xE9,0xCC,0x73,0xFF,
0xF8,0xEF,0xD8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFD,0xFF,0xFF,0xFF,0xEE,0xDF,0xA9,0xFF,
0xE7,0xCA,0x6F,0xFF,0xEA,0xCF,0x7B,0xFF,0xEA,0xCF,0x7E,0xFF,0xEA,0xCF,0x7E,0xFF,
0xEB,0xD0,0x7E,0xFF,0xE5,0xC8,0x6C,0xFF,0xF6,0xF2,0xE0,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE8,0xD2,0x91,0xFF,0xED,0xD1,0x7E,0xFF,
0xED,0xD2,0x81,0xFF,0xED,0xD2,0x81,0xFF,0xED,0xD2,0x81,0xFF,0xEB,0xCE,0x75,0xFF,
0xF9,0xF4,0xE4,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFD,0xFF,0xFF,0xFF,0xEB,0xD5,0x8D,0xFF,0xED,0xD1,0x7F,0xFF,0xED,0xD2,0x81,0xFF,
0xED,0xD2,0x81,0xFF,0xE7,0xCA,0x70,0xFF,0xF7,0xF2,0xE1,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xEA,0xD4,0x92,0xFF,0xEF,0xD3,0x80,0xFF,
0xEF,0xD4,0x83,0xFF,0xEF,0xD4,0x83,0xFF,0xEF,0xD4,0x83,0xFF,0xEE,0xD0,0x76,0xFF,
0xFA,0xF9,0xF1,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF8,0xF6,0xE7,0xFF,0xF2,0xE3,0xB1,0xFF,
0xED,0xD2,0x7F,0xFF,0xEE,0xD3,0x7F,0xFF,0xEF,0xD4,0x83,0xFF,0xEF,0xD4,0x83,0xFF,
0xEF,0xD4,0x84,0xFF,0xEA,0xCC,0x72,0xFF,0xF7,0xF2,0xE1,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE8,0xD4,0x93,0xFF,0xEF,0xD7,0x82,0xFF,
0xEF,0xD7,0x85,0xFF,0xEF,0xD7,0x85,0xFF,0xEF,0xD7,0x85,0xFF,0xEE,0xD3,0x78,0xFF,
0xFC,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFA,0xF7,0xEC,0xFF,
0xF3,0xE6,0xB6,0xFF,0xEE,0xD4,0x82,0xFF,0xEE,0xD3,0x79,0xFF,0xEE,0xD5,0x7F,0xFF,
0xEF,0xD7,0x84,0xFF,0xEF,0xD7,0x85,0xFF,0xEF,0xD7,0x85,0xFF,0xEF,0xD7,0x85,0xFF,
0xEF,0xD8,0x86,0xFF,0xEA,0xCF,0x75,0xFF,0xF8,0xF3,0xE0,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xEA,0xD5,0x95,0xFF,0xF1,0xD7,0x84,0xFF,
0xF0,0xD7,0x86,0xFF,0xF0,0xD7,0x86,0xFF,0xF0,0xD8,0x86,0xFF,0xEE,0xD4,0x7D,0xFF,
0xFB,0xFC,0xF8,0xFF,0xF4,0xE8,0xBB,0xFF,0xEF,0xD7,0x87,0xFF,0xEF,0xD4,0x79,0xFF,
0xF0,0xD5,0x80,0xFF,0xF0,0xD7,0x85,0xFF,0xF0,0xD8,0x86,0xFF,0xF0,0xD7,0x86,0xFF,
0xF0,0xD7,0x86,0xFF,0xF0,0xD7,0x86,0xFF,0xF0,0xD7,0x86,0xFF,0xF0,0xD7,0x86,0xFF,
0xF1,0xD8,0x87,0xFF,0xED,0xCF,0x76,0xFF,0xF8,0xF2,0xE1,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xED,0xD9,0x9B,0xFF,0xF3,0xD8,0x89,0xFF,
0xF4,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,0xF3,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,
0xF3,0xD7,0x81,0xFF,0xF3,0xD8,0x87,0xFF,0xF3,0xD9,0x8C,0xFF,0xF4,0xDA,0x8D,0xFF,
0xF4,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,
0xF4,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,
0xF4,0xDA,0x8E,0xFF,0xEE,0xD2,0x7D,0xFF,0xF8,0xF5,0xE7,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF2,0xE6,0xBD,0xFF,0xF1,0xDA,0x96,0xFF,
0xF4,0xDD,0x9C,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,
0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,
0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,
0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9C,0xFF,
0xF4,0xDE,0xA0,0xFF,0xEB,0xD3,0x87,0xFF,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFC,0xFE,0xFE,0xFF,0xEB,0xD3,0x83,0xFF,
0xF7,0xE7,0xBB,0xFF,0xF5,0xE0,0xA6,0xFF,0xF5,0xE1,0xA7,0xFF,0xF5,0xE1,0xA7,0xFF,
0xF5,0xE1,0xA7,0xFF,0xF5,0xE1,0xA7,0xFF,0xF5,0xE0,0xA7,0xFF,0xF5,0xE0,0xA7,0xFF,
0xF5,0xE0,0xA7,0xFF,0xF5,0xE0,0xA7,0xFF,0xF5,0xE0,0xA7,0xFF,0xF5,0xE1,0xA7,0xFF,
0xF5,0xE1,0xA7,0xFF,0xF5,0xE1,0xA7,0xFF,0xF5,0xE0,0xA6,0xFF,0xF5,0xE1,0xA9,0xFF,
0xF5,0xE7,0xC0,0xFF,0xEF,0xDD,0xA4,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF5,0xEC,0xCF,0xFF,
0xED,0xD7,0x8F,0xFF,0xFB,0xF0,0xD9,0xFF,0xFA,0xEE,0xD2,0xFF,0xF9,0xEE,0xD1,0xFF,
0xF9,0xEE,0xD2,0xFF,0xF9,0xEE,0xD2,0xFF,0xFA,0xEE,0xD2,0xFF,0xF9,0xEE,0xD2,0xFF,
0xF9,0xEE,0xD2,0xFF,0xF9,0xEE,0xD2,0xFF,0xFA,0xEE,0xD2,0xFF,0xF9,0xEE,0xD2,0xFF,
0xF9,0xEE,0xD2,0xFF,0xF9,0xEE,0xD2,0xFF,0xFA,0xF0,0xD7,0xFF,0xF6,0xEB,0xCA,0xFF,
0xEB,0xD2,0x81,0xFF,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xF8,0xF5,0xE4,0xFF,0xEE,0xDB,0x97,0xFF,0xEF,0xDA,0x94,0xFF,0xF1,0xDB,0x96,0xFF,
0xF1,0xDB,0x96,0xFF,0xF1,0xDB,0x96,0xFF,0xF1,0xDB,0x96,0xFF,0xF1,0xDB,0x95,0xFF,
0xF1,0xDB,0x96,0xFF,0xF1,0xDB,0x95,0xFF,0xF1,0xDB,0x96,0xFF,0xF1,0xDB,0x96,0xFF,
0xF1,0xDB,0x96,0xFF,0xF1,0xDA,0x95,0xFF,0xEF,0xD9,0x93,0xFF,0xF1,0xE2,0xAE,0xFF,
0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
};

static void ap_fill_color(struct dis_rect *dis_rect, uint32_t color)
{
	uint32_t i = 0;
	uint32_t j = 0;
	int16_t *fb_dis_16b = NULL;
	int32_t *fb_dis_32b = NULL;
	int8_t *fb_dis_8b = NULL;
	int ret = 0;
	uint32_t x_end = 0;
	uint32_t y_end = 0;

	printf("fb_base=0x%x,y_start=%d,hight=%d,x_start=%d,x_width=%d,xres=%d\n",
	       (unsigned int)fb_base, (unsigned int)dis_rect->y_start,
	       (unsigned int)dis_rect->y_hight, (unsigned int)dis_rect->x_start,
	       (unsigned int)dis_rect->x_width, (unsigned int)var.xres);
	//return;
	fb_dis_16b = (int16_t *)fb_base;
	fb_dis_8b = (int8_t *)fb_base;
	fb_dis_32b = (int32_t *)fb_base;
	x_end = dis_rect->x_start + dis_rect->x_width;
	if (x_end > var.xres) {
		x_end = var.xres;
	}

	y_end = dis_rect->y_start + dis_rect->y_hight;
	if (y_end > var.yres) {
		y_end = var.yres;
	}

	for (j = dis_rect->y_start; j < y_end; j++) {
		for (i = dis_rect->x_start; i < x_end; i++) {
			if (color_bit == 32) {
				fb_dis_32b[j * var.xres + i] = color;
			} else if (color_bit == 16) {
				fb_dis_16b[j * var.xres + i] = color;
			} else if (color_bit == 8) {
				fb_dis_8b[j * var.xres + i] = color;
			}
		}
	}
}

static void ap_dis_bmp(struct dis_rect *dis_rect, uint8_t *buf)
{
	uint32_t i = 0;
	uint32_t j = 0;
	int16_t *fb_dis_16b = NULL;
	int32_t *fb_dis_32b = NULL;
	int8_t *fb_dis_8b = NULL;
	int16_t *fb_src_16b = NULL;
	int32_t *fb_src_32b = NULL;
	int8_t *fb_src_8b = NULL;
	int ret = 0;
	int src_pos = 0;
	uint32_t x_end = 0;
	uint32_t y_end = 0;

	printf("fb_base=0x%x,y_start=%d,hight=%d,x_start=%d,x_width=%d,xres=%d\n",
	       (unsigned int)fb_base, (unsigned int)dis_rect->y_start,
	       (unsigned int)dis_rect->y_hight, (unsigned int)dis_rect->x_start,
	       (unsigned int)dis_rect->x_width, (unsigned int)var.xres);
	//return;
	fb_dis_16b = (int16_t *)fb_base;
	fb_dis_8b = (int8_t *)fb_base;
	fb_dis_32b = (int32_t *)fb_base;
	fb_src_16b = (int16_t *)buf;
	fb_src_32b = (int32_t *)buf;
	fb_src_8b = (int8_t *)buf;

	x_end = dis_rect->x_start + dis_rect->x_width;
	if (x_end > var.xres) {
		x_end = var.xres;
	}

	y_end = dis_rect->y_start + dis_rect->y_hight;
	if (y_end > var.yres) {
		y_end = var.yres;
	}

	for (j = dis_rect->y_start; j < y_end; j++) {
		for (i = dis_rect->x_start; i < x_end; i++) {
			if (color_bit == 32) {
				fb_dis_32b[j * var.xres + i] =
					fb_src_32b[src_pos++];
			} else if (color_bit == 16) {
				fb_dis_16b[j * var.xres + i] =
					fb_src_16b[src_pos++];
			} else if (color_bit == 8) {
				fb_dis_8b[j * var.xres + i] =
					fb_src_8b[src_pos++];
			}
		}
	}
}

static void ap_dis_font(struct dis_rect *dis_rect, uint8_t *buf)
{
	uint32_t i = 0;
	uint32_t j = 0;
	int16_t *fb_dis_16b = NULL;
	int32_t *fb_dis_32b = NULL;
	int8_t *fb_dis_8b = NULL;
	int16_t *fb_src_16b = NULL;
	int32_t *fb_src_32b = NULL;
	int8_t *fb_src_8b = NULL;
	int ret = 0;
	int src_pos = 0;
	uint32_t x_end = 0;
	uint32_t y_end = 0;

	printf("fb_base=0x%x,y_start=%d,hight=%d,x_start=%d,x_width=%d,xres=%d\n",
	       (unsigned int)fb_base, (unsigned int)dis_rect->y_start,
	       (unsigned int)dis_rect->y_hight, (unsigned int)dis_rect->x_start,
	       (unsigned int)dis_rect->x_width, (unsigned int)var.xres);
	//return;
	fb_dis_16b = (int16_t *)fb_base;
	fb_dis_8b = (int8_t *)fb_base;
	fb_dis_32b = (int32_t *)fb_base;
	fb_src_16b = (int16_t *)buf;
	fb_src_32b = (int32_t *)buf;
	fb_src_8b = (int8_t *)buf;

	x_end = dis_rect->x_start + dis_rect->x_width;
	if (x_end > var.xres) {
		x_end = var.xres;
	}

	y_end = dis_rect->y_start + dis_rect->y_hight;
	if (y_end > var.yres) {
		y_end = var.yres;
	}

	for (j = dis_rect->y_start; j < x_end; j++) {
		for (i = dis_rect->x_start; i < y_end; i++) {
			if (color_bit == 32) {
				fb_dis_32b[j * var.xres + i] =
					fb_src_32b[src_pos++];
			} else if (color_bit == 16) {
				fb_dis_16b[j * var.xres + i] =
					fb_src_16b[src_pos++];
			} else if (color_bit == 8) {
				fb_dis_8b[j * var.xres + i] =
					fb_src_8b[src_pos++];
			}
		}
	}
}

static int fb_open_show(int argc, char **argv)
{
	int i;
	int ret;
	int buffer_num;
	int fd;
	struct dis_layer_blend_order vhance = { 0 };
	if (argc > 1) {
		color_bit = atoi(argv[1]);
	}
	#ifdef MOUSE_DEMO
	fd_fb = open(DEV_FB1, O_RDWR);
	#else
	fd_fb = open(DEV_FB0, O_RDWR);
	#endif
	printf("size=%d\n", (int)sizeof(var));
	if (ioctl(fd_fb, FBIOGET_VSCREENINFO, &var) == -1) {
		printf("Error reading variable information");
	}
	printf("xres=%d,yres=%d,vx=%d,vy=%d\n", (unsigned int)var.xres,
	       (unsigned int)var.yres, (unsigned int)var.xres_virtual,
	       (unsigned int)var.yres_virtual);

//printf("fix=%d,yres=%d,vx=%d,vy=%d\n",(unsigned int)var.xres,var.yres,var.xres_virtual,var.yres_virtual);

/*var.activate = FB_ACTIVATE_VBL;*/
#ifdef __linux__
	var.activate |= FB_ACTIVATE_NOW; //B_ACTIVATE_FORCE;
#endif
	if (color_bit == 16) {
		var.bits_per_pixel = 16;
		var.red.length = 5;
		var.green.length = 6;
		var.blue.length = 5;
		var.yres_virtual = var.yres;
	} else if (color_bit == 32) {
		var.yoffset = 0;
		var.xoffset = 0;
		var.transp.length = 8;
		var.bits_per_pixel = 32;
		var.red.length = 8;
		var.green.length = 8;
		var.blue.length = 8;
		#ifdef MOUSE_DEMO
		var.xres = 24;
		var.yres = 24;
		var.xres_virtual = var.xres;
		#endif
		var.yres_virtual = var.yres;
	}
	//set variable information
	if (ioctl(fd_fb, FBIOPUT_VSCREENINFO, &var) == -1) {
		printf("Error reading variable information");
		return -1;
	}
	ioctl(fd_fb, FBIOGET_FSCREENINFO, &fix);
	line_width = var.xres * var.bits_per_pixel / 8;
	pixel_width = var.bits_per_pixel / 8;
	screen_size = var.xres * var.yres * var.bits_per_pixel / 8;

	// 1. 获得 buffer 个数
	buffer_num = fix.smem_len / screen_size;
	printf("buffer_num=%d\n", buffer_num);

	if (ioctl(fd_fb, HCFBIOSET_SCALE, &scale_param) != 0) {
		printf("ioctl(set scale param)");
		return -1;
	}

	ioctl(fd_fb, HCFBIOSET_MMAP_CACHE, HCFB_MMAP_NO_CACHE);
	fb_base = (unsigned char *)mmap(NULL, fix.smem_len,
					PROT_READ | PROT_WRITE, MAP_SHARED,
					fd_fb, 0);
	if (fb_base == MAP_FAILED) {
		printf("can't mmap\n");
		return -1;
	}

	memset(fb_base, 0x00, fix.smem_len);
	//Make sure that the display is on.
	if (ioctl(fd_fb, FBIOBLANK, FB_BLANK_UNBLANK) != 0) {
		printf("%s:%d\n", __func__, __LINE__);
	}
	#ifdef MOUSE_DEMO
	fd = open("/dev/dis" , O_WRONLY);
	if(fd < 0) {
		return -1;
	}
	vhance.distype = DIS_TYPE_HD;
	vhance.main_layer = 0;
	vhance.auxp_layer = 1;
	vhance.gmaf_layer = 2;
	vhance.gmas_layer = 3;
	ioctl(fd , DIS_SET_LAYER_ORDER , &vhance);

	close(fd);
	#endif
	return 0;
}

static int fb_close_show(int argc, char **argv)
{
	return 0;
}


static int fb_dis_scale_color(int argc, char **argv)
{
	struct dis_rect show_rect;
	uint32_t dis_color = 0xffffffff;
	
	
	if (argc > 1) {
		show_rect.x_start = atoi(argv[1]);
		show_rect.x_width = atoi(argv[2]);
		show_rect.y_start = atoi(argv[3]);
		show_rect.y_hight = atoi(argv[4]);
		dis_color = atoi(argv[5]);
	} else {
		#ifdef MOUSE_DEMO
		show_rect.x_start = 0;
		show_rect.x_width = 24;
		show_rect.y_start = 0;
		show_rect.y_hight = 24;
		#else
		show_rect.x_start = 0;
		show_rect.x_width = 1280;
		show_rect.y_start = 0;
		show_rect.y_hight = 720;
		#endif
	}
	#ifdef MOUSE_DEMO
	scale_param.h_mul = 1;
	scale_param.v_mul = 1;
	#else
	scale_param.h_mul = 1280;
	scale_param.v_mul = 720;
	#endif
	pos.left += 50;
	pos.top += 50;
	
	
	if (ioctl(fd_fb, HCFBIOSET_SET_LEFTTOP_POS, &pos) != 0) {
			printf("ioctl(set scale param)");
			return -1;
	}
	if (ioctl(fd_fb, HCFBIOSET_SCALE, &scale_param) != 0) {
			printf("ioctl(set scale param)");
			return -1;
	}
	dis_color = 0xffff0000;
	ap_fill_color(&show_rect,dis_color);
	return 0;
}
static int fb_dis_color(int argc, char **argv)
{
	struct dis_rect show_rect;
	uint32_t dis_color = 0xffffffff;
	
	if (argc > 1) {
		show_rect.x_start = atoi(argv[1]);
		show_rect.x_width = atoi(argv[2]);
		show_rect.y_start = atoi(argv[3]);
		show_rect.y_hight = atoi(argv[4]);
		dis_color = atoi(argv[5]);
	} else {
		show_rect.x_start = 0;
		show_rect.x_width = 1280;
		show_rect.y_start = 0;
		show_rect.y_hight = 720;
	}
	ap_fill_color(&show_rect,dis_color);
	return 0;
}

static int fb_dis_bmp(int argc, char **argv)
{
	static int bmp_pos = 0;
	struct dis_rect show_rect;
	uint32_t dis_color = 0xffffffff;
	
	
	if (argc > 1) {
		show_rect.x_start = atoi(argv[1]);
		show_rect.x_width = atoi(argv[2]);
		show_rect.y_start = atoi(argv[3]);
		show_rect.y_hight = atoi(argv[4]);
		dis_color = atoi(argv[5]);
	} else {
		show_rect.x_start = 0;
		show_rect.x_width = 24;
		show_rect.y_start = 0;
		show_rect.y_hight = 24;
	}
	
	pos.left = 0;
	pos.top = 0;
	
	
	if (ioctl(fd_fb, HCFBIOSET_SET_LEFTTOP_POS, &pos) != 0) {
			printf("ioctl(set scale param)");
			return -1;
	}
	
	show_rect.x_start = 0;
	show_rect.x_width = 24;
	show_rect.y_start = 0;
	show_rect.y_hight = 24;
	bmp_buf = bmp_array;
	ap_dis_bmp(&show_rect, bmp_buf);
	return 0;
}

static int fb_dis_bmp_move(int argc, char **argv)
{
	static int bmp_pos = 0;
	struct dis_rect show_rect;
	uint32_t dis_color = 0xffffffff;
	
	
	if (argc > 1) {
		pos.left = atoi(argv[1]);
		pos.top = atoi(argv[2]);
	} else {
		show_rect.x_start = 0;
		show_rect.x_width = 24;
		show_rect.y_start = 0;
		show_rect.y_hight = 24;
	}	
	
	if (ioctl(fd_fb, HCFBIOSET_SET_LEFTTOP_POS, &pos) != 0) {
			printf("ioctl(set scale param)");
			return -1;
	}
	
    if (ioctl(fd_fb, FBIOPAN_DISPLAY, &var) < 0) {
        perror("ioctl() / FBIOPAN_DISPLAY");
    }

	return 0;
}
static int fb_dis_font(int argc, char **argv)
{
	struct dis_rect show_rect;

	show_rect.x_start = 0;
	show_rect.x_width = 100;
	show_rect.y_start = 0;
	show_rect.y_hight = 100;

	ap_dis_bmp(&show_rect, font_buf);
	return 0;
}

CONSOLE_CMD(fb_dopen, "fb", fb_open_show, CONSOLE_CMD_MODE_SELF,
	    "fb demo open")
CONSOLE_CMD(fb_dclose, "fb", fb_close_show, CONSOLE_CMD_MODE_SELF,
	    "fb demo close")
CONSOLE_CMD(dis_color, "fb", fb_dis_color, CONSOLE_CMD_MODE_SELF,
	    "fb demo show color")
CONSOLE_CMD(dis_bmp, "fb", fb_dis_bmp, CONSOLE_CMD_MODE_SELF,
	    "fb demo dis bmp")
CONSOLE_CMD(dis_font, "fb", fb_dis_font, CONSOLE_CMD_MODE_SELF,
	    "fb demo dis font")
CONSOLE_CMD(dis_scale, "fb", fb_dis_scale_color, CONSOLE_CMD_MODE_SELF,
		"fb dis color scale")
CONSOLE_CMD(dis_bmp_move, "fb_demo", fb_dis_bmp_move, CONSOLE_CMD_MODE_SELF,
		"fb bmp move")

