#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <unistd.h>
#include <string.h>
#include <stdbool.h>
#include <pthread.h>
#include <getopt.h>
#include <sys/mman.h>
#include <fcntl.h>
#include <sys/ioctl.h>

#include <linux/fb.h>
#include <hcuapi/fb.h>
#include <hcuapi/dis.h>
#include <hcuapi/common.h>

#ifdef __linux__
#include <termios.h>
#include <signal.h>
#include "console.h"
#else
#include <kernel/lib/console.h>
#endif


#define NO_WINDOW		(0)
#define HAMMING_WINDOW		(1)
#define LANCZOS_WINDOW		(2)

#define WINDOW_TYPE		(LANCZOS_WINDOW)

#define FIXED_BITS		(32)
#define FRAC_BITS		(16)
#define FRAC_MASK		((1 << (FRAC_BITS)) - 1)
#define INT_BITS		((FIXED_BITS) - (FRAC_BITS))

#define FRAC_MAX		((int)(0x7fffffff))
#define FRAC_MIN		((int)(0x80000000))
#define FRAC_ONE		(1 << (FRAC_BITS))
#define FRAC_TWO		((FRAC_ONE) << 1)
#define FRAC_HALF		((FRAC_ONE) >> 1)
#define FRAC_QUARTER		((FRAC_ONE) >> 2)

#define FLOAT_TO_FRAC(x)	((int)((x) * (FRAC_ONE)))
#define DOUBLE_TO_FRAC(x)	((int)((x) * (FRAC_ONE)))
#define INT_TO_FRAC(x)		((x) << (FRAC_BITS))
#define FRAC_TO_DOUBLE(x)	((float)(x) / (FRAC_ONE))
#define PI 3.141592653589793238462643383279502884197169399375105820974944592
#define INV_PI (1/PI)
#define FRAC_INV_PI		(DOUBLE_TO_FRAC(INV_PI))
#define FRAC_INV_2PI_SQ		(DOUBLE_TO_FRAC(1/(4*PI*PI)))

#define MY_BITS			(16)
#define MY0			(93.484f)
#define MY1			(314.486f)
#define MY2			(31.7476f)
#define MY3			(439.7176f)

#define MC0_1			(51.542f)
#define MC0_2			(224.8784f)
#define MC1_1			(173.336f)
#define MC1_2			(204.2796f)
#define MC2_1			(224.8784f)
#define MC2_2			(20.5989f)

#define FLOOR(x) ((int)((x) + 0.5f))

#ifndef FBDEV_PATH
#define FBDEV_PATH  "/dev/fb0"
#define FBDEV_PATH2  "/dev/fb1"
#endif

//#define MOUSE_DEMO_ENABLE

#ifdef MOUSE_DEMO_ENABLE
#define FB_WIDTH (24)
#define FB_HIGTH (24)
#else
#define FB_WIDTH (1280)
#define FB_HIGTH (720)
#endif
#define COLOR_BIT (32)

static struct termios stored_settings;

#define ENTRY_BITS		(8)
static const unsigned short cos_lut[1 << ENTRY_BITS] = {
	65535, 65531, 65525, 65516, 65505, 65492, 65476, 65457, 65436, 65413,
	65387, 65358, 65328, 65294, 65259, 65220, 65180, 65137, 65091, 65043,
	64993, 64940, 64884, 64827, 64766, 64704, 64639, 64571, 64501, 64429,
	64354, 64277, 64197, 64115, 64031, 63944, 63854, 63763, 63668, 63572,
	63473, 63372, 63268, 63162, 63054, 62943, 62830, 62714, 62596, 62476,
	62353, 62228, 62101, 61971, 61839, 61705, 61568, 61429, 61288, 61145,
	60999, 60851, 60700, 60547, 60392, 60235, 60075, 59914, 59750, 59583,
	59415, 59244, 59071, 58896, 58718, 58538, 58356, 58172, 57986, 57798,
	57607, 57414, 57219, 57022, 56823, 56621, 56418, 56212, 56004, 55794,
	55582, 55368, 55152, 54934, 54714, 54491, 54267, 54040, 53812, 53581,
	53349, 53114, 52878, 52639, 52398, 52156, 51911, 51665, 51417, 51166,
	50914, 50660, 50404, 50146, 49886, 49624, 49361, 49095, 48828, 48559,
	48288, 48015, 47741, 47464, 47186, 46906, 46624, 46341, 46056, 45769,
	45480, 45190, 44898, 44604, 44308, 44011, 43713, 43412, 43110, 42806,
	42501, 42194, 41886, 41576, 41264, 40951, 40636, 40320, 40002, 39683,
	39362, 39040, 38716, 38391, 38064, 37736, 37407, 37076, 36744, 36410,
	36075, 35738, 35401, 35062, 34721, 34380, 34037, 33692, 33347, 33000,
	32652, 32303, 31952, 31600, 31248, 30893, 30538, 30182, 29824, 29466,
	29106, 28745, 28383, 28020, 27656, 27291, 26925, 26558, 26190, 25821,
	25451, 25080, 24708, 24335, 23961, 23586, 23210, 22834, 22457, 22078,
	21699, 21320, 20939, 20557, 20175, 19792, 19409, 19024, 18639, 18253,
	17867, 17479, 17091, 16703, 16314, 15924, 15534, 15143, 14751, 14359,
	13966, 13573, 13180, 12785, 12391, 11996, 11600, 11204, 10808, 10411,
	10014, 9616,  9218,  8820,  8421,  8022,  7623,  7224,  6824,  6424,
	6023,  5623,  5222,  4821,  4420,  4019,  3617,  3216,  2814,  2412,
	2010,  1608,  1206,  804,   402,   0,
};

static unsigned short red_16[] = {
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001,
	0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001,
	0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001,
	0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0005, 0x0005, 0x0005, 0x0005, 0x0005, 0x0005, 0x0005, 0x0005,
	0x0005, 0x0005, 0x0005, 0x0005, 0x0005, 0x0005, 0x0005, 0x0005,
	0x0005, 0x0005, 0x0005, 0x0005, 0x0005, 0x0005, 0x0005, 0x0005,
	0x0005, 0x0005, 0x0005, 0x0005, 0x0005, 0x0005, 0x0005, 0x0005,
	0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006,
	0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006,
	0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006,
	0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006,
	0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007,
	0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007,
	0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007,
	0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007, 0x0007,
};
static unsigned short green_16[] = {
    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001,
    0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
    0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001,
    0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
    0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001,
    0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
    0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001,
    0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
    0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001,
    0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
    0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001,
    0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
    0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001,
    0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
    0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001,
    0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
    0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
};
static unsigned short blue_16[] = {
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
	0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007,
};

static unsigned short alpha_16[] = {
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
	0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003, 0x0003,
};
char bmp_array[]=
{
	0xFF,0xFF,0xFF,0xFF,0xFE,0xFE,0xFE,0xFF,0xFD,0xFD,0xFD,0xFF,0xFB,0xFB,0xFB,0xFF,
	0xFB,0xFC,0xFF,0xFF,0xFD,0xFF,0xFF,0xFF,0xF6,0xF6,0xFA,0xFF,0xF1,0xF2,0xF4,0xFF,
	0xEE,0xEF,0xF1,0xFF,0xEB,0xEC,0xEE,0xFF,0xE8,0xE9,0xEB,0xFF,0xE7,0xE9,0xEA,0xFF,
	0xE8,0xE9,0xEB,0xFF,0xEA,0xEB,0xEC,0xFF,0xEC,0xED,0xEF,0xFF,0xF0,0xF1,0xF3,0xFF,
	0xF3,0xF4,0xF6,0xFF,0xF5,0xF6,0xF8,0xFF,0xFD,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFC,0xFD,0xFF,0xFF,0xFD,0xFD,0xFD,0xFF,0xFE,0xFE,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFE,0xFE,0xFE,0xFF,0xFE,0xFE,0xFE,0xFF,0xFC,0xFC,0xFC,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xE1,0xDB,0xC1,0xFF,0xBD,0xA4,0x4B,0xFF,0xB9,0x9C,0x38,0xFF,0xBA,0x9E,0x3A,0xFF,
	0xBB,0x9E,0x3A,0xFF,0xBB,0x9F,0x3B,0xFF,0xBB,0x9F,0x3B,0xFF,0xBB,0x9F,0x3B,0xFF,
	0xBB,0x9F,0x3B,0xFF,0xBB,0x9F,0x3B,0xFF,0xBB,0x9F,0x3A,0xFF,0xBB,0x9E,0x3A,0xFF,
	0xBA,0x9E,0x3A,0xFF,0xBA,0x9D,0x39,0xFF,0xB6,0x9B,0x37,0xFF,0xCB,0xB9,0x74,0xFF,
	0xFA,0xFB,0xFD,0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0xFE,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE5,0xDC,0xB5,0xFF,
	0xC3,0xA4,0x38,0xFF,0xCA,0xAF,0x4E,0xFF,0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,
	0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,
	0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,
	0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x51,0xFF,0xCB,0xB0,0x50,0xFF,0xC8,0xAC,0x48,0xFF,
	0xC5,0xAA,0x48,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFC,0xFD,0xFB,0xFF,0xCC,0xAC,0x3E,0xFF,
	0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,
	0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,
	0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,
	0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,0xD3,0xB7,0x54,0xFF,
	0xD1,0xB3,0x4B,0xFF,0xDB,0xCA,0x85,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE6,0xDA,0xA8,0xFF,0xD2,0xB3,0x4C,0xFF,
	0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,
	0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,
	0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x57,0xFF,0xD5,0xB8,0x58,0xFF,
	0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,0xD5,0xB8,0x58,0xFF,
	0xD5,0xB8,0x57,0xFF,0xCE,0xAF,0x42,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xDE,0xC9,0x84,0xFF,0xD3,0xB8,0x55,0xFF,
	0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,
	0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,
	0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5B,0xFF,0xD3,0xB7,0x55,0xFF,0xD2,0xB6,0x51,0xFF,
	0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,0xD5,0xBA,0x5C,0xFF,
	0xD5,0xBA,0x5C,0xFF,0xD1,0xB3,0x4C,0xFF,0xF5,0xF2,0xE1,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xDD,0xC9,0x83,0xFF,0xD5,0xB9,0x5B,0xFF,
	0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,
	0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,
	0xD6,0xBB,0x60,0xFF,0xD3,0xB5,0x50,0xFF,0xEC,0xE4,0xC3,0xFF,0xED,0xE5,0xC6,0xFF,
	0xD1,0xB3,0x4A,0xFF,0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,0xD6,0xBB,0x60,0xFF,
	0xD6,0xBB,0x60,0xFF,0xD3,0xB6,0x51,0xFF,0xF5,0xEF,0xDD,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xDE,0xCA,0x83,0xFF,0xD6,0xBB,0x59,0xFF,
	0xD7,0xBD,0x5F,0xFF,0xD7,0xBD,0x5F,0xFF,0xD7,0xBD,0x5F,0xFF,0xD7,0xBD,0x5E,0xFF,
	0xD7,0xBE,0x61,0xFF,0xD5,0xBA,0x59,0xFF,0xD7,0xBD,0x5F,0xFF,0xD7,0xBD,0x5F,0xFF,
	0xD6,0xBB,0x59,0xFF,0xD9,0xC4,0x76,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xEF,0xE9,0xCF,0xFF,0xD3,0xB8,0x53,0xFF,0xD7,0xBD,0x5E,0xFF,0xD7,0xBD,0x5F,0xFF,
	0xD7,0xBD,0x5F,0xFF,0xD3,0xB7,0x50,0xFF,0xF6,0xF0,0xDE,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE2,0xCC,0x86,0xFF,0xDA,0xBD,0x5E,0xFF,
	0xDB,0xBF,0x64,0xFF,0xDB,0xBF,0x64,0xFF,0xDB,0xBF,0x64,0xFF,0xDB,0xBD,0x60,0xFF,
	0xE1,0xCB,0x84,0xFF,0xE5,0xD7,0xA0,0xFF,0xDA,0xBB,0x5B,0xFF,0xDB,0xBE,0x63,0xFF,
	0xD6,0xB7,0x53,0xFF,0xFD,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xE2,0xCF,0x8E,0xFF,0xDA,0xBD,0x5F,0xFF,0xDB,0xBF,0x64,0xFF,
	0xDB,0xBF,0x64,0xFF,0xD8,0xB9,0x55,0xFF,0xF5,0xF0,0xDE,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE1,0xCD,0x87,0xFF,0xD9,0xBE,0x61,0xFF,
	0xDA,0xC0,0x66,0xFF,0xDA,0xC0,0x66,0xFF,0xDA,0xC0,0x66,0xFF,0xD9,0xBE,0x60,0xFF,
	0xE1,0xCD,0x88,0xFF,0xFF,0xFF,0xFF,0xFF,0xD7,0xBA,0x5B,0xFF,0xD7,0xB8,0x53,0xFF,
	0xEE,0xE7,0xCA,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xEF,0xEA,0xD0,0xFF,0xD7,0xB8,0x54,0xFF,0xDA,0xC0,0x66,0xFF,0xDA,0xC0,0x66,0xFF,
	0xDA,0xC0,0x66,0xFF,0xD8,0xBA,0x57,0xFF,0xF7,0xF1,0xDF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE2,0xCF,0x8A,0xFF,0xDB,0xC0,0x62,0xFF,
	0xDC,0xC2,0x67,0xFF,0xDB,0xC1,0x67,0xFF,0xDB,0xC2,0x67,0xFF,0xDC,0xC0,0x63,0xFF,
	0xE6,0xD5,0x98,0xFF,0xFF,0xFF,0xFF,0xFF,0xF1,0xEA,0xCB,0xFF,0xE0,0xCB,0x80,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFD,0xFF,0xFF,0xFF,
	0xD9,0xBC,0x5D,0xFF,0xDB,0xC1,0x66,0xFF,0xDB,0xC1,0x67,0xFF,0xDC,0xC2,0x67,0xFF,
	0xDC,0xC2,0x68,0xFF,0xD9,0xBD,0x5A,0xFF,0xF7,0xF1,0xDF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE3,0xCF,0x8B,0xFF,0xDF,0xC5,0x68,0xFF,
	0xE2,0xC8,0x72,0xFF,0xE5,0xCA,0x75,0xFF,0xE6,0xCC,0x77,0xFF,0xE5,0xC9,0x6F,0xFF,
	0xED,0xDF,0xAD,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFD,0xFE,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE6,0xD2,0x8D,0xFF,
	0xE5,0xCA,0x70,0xFF,0xE6,0xCC,0x77,0xFF,0xE5,0xCA,0x75,0xFF,0xE2,0xC8,0x72,0xFF,
	0xE0,0xC6,0x6D,0xFF,0xDA,0xBE,0x5D,0xFF,0xF7,0xF1,0xDF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE4,0xCF,0x8D,0xFF,0xE6,0xCB,0x75,0xFF,
	0xE6,0xCD,0x78,0xFF,0xE6,0xCC,0x78,0xFF,0xE6,0xCC,0x77,0xFF,0xE4,0xCA,0x6F,0xFF,
	0xF0,0xE5,0xBB,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF2,0xE9,0xC9,0xFF,0xE4,0xC7,0x69,0xFF,
	0xE6,0xCC,0x77,0xFF,0xE6,0xCC,0x77,0xFF,0xE6,0xCC,0x78,0xFF,0xE6,0xCD,0x78,0xFF,
	0xE7,0xCC,0x7A,0xFF,0xE2,0xC5,0x68,0xFF,0xF7,0xF1,0xE0,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE5,0xD0,0x8D,0xFF,0xE8,0xCE,0x76,0xFF,
	0xE8,0xCE,0x7A,0xFF,0xE8,0xCE,0x7A,0xFF,0xE8,0xCE,0x7A,0xFF,0xE7,0xCB,0x70,0xFF,
	0xF4,0xEA,0xCA,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFD,0xFF,0xFF,0xFF,0xE2,0xC4,0x63,0xFF,0xE8,0xCC,0x73,0xFF,
	0xE8,0xCE,0x7A,0xFF,0xE8,0xCE,0x7A,0xFF,0xE8,0xCE,0x7A,0xFF,0xE8,0xCE,0x7A,0xFF,
	0xE8,0xCF,0x7B,0xFF,0xE4,0xC7,0x69,0xFF,0xF7,0xF1,0xDF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE6,0xD1,0x8F,0xFF,0xEA,0xCF,0x7B,0xFF,
	0xEA,0xCF,0x7E,0xFF,0xEA,0xCF,0x7E,0xFF,0xEA,0xCF,0x7E,0xFF,0xE9,0xCC,0x73,0xFF,
	0xF8,0xEF,0xD8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFD,0xFF,0xFF,0xFF,0xEE,0xDF,0xA9,0xFF,
	0xE7,0xCA,0x6F,0xFF,0xEA,0xCF,0x7B,0xFF,0xEA,0xCF,0x7E,0xFF,0xEA,0xCF,0x7E,0xFF,
	0xEB,0xD0,0x7E,0xFF,0xE5,0xC8,0x6C,0xFF,0xF6,0xF2,0xE0,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE8,0xD2,0x91,0xFF,0xED,0xD1,0x7E,0xFF,
	0xED,0xD2,0x81,0xFF,0xED,0xD2,0x81,0xFF,0xED,0xD2,0x81,0xFF,0xEB,0xCE,0x75,0xFF,
	0xF9,0xF4,0xE4,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFD,0xFF,0xFF,0xFF,0xEB,0xD5,0x8D,0xFF,0xED,0xD1,0x7F,0xFF,0xED,0xD2,0x81,0xFF,
	0xED,0xD2,0x81,0xFF,0xE7,0xCA,0x70,0xFF,0xF7,0xF2,0xE1,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xEA,0xD4,0x92,0xFF,0xEF,0xD3,0x80,0xFF,
	0xEF,0xD4,0x83,0xFF,0xEF,0xD4,0x83,0xFF,0xEF,0xD4,0x83,0xFF,0xEE,0xD0,0x76,0xFF,
	0xFA,0xF9,0xF1,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF8,0xF6,0xE7,0xFF,0xF2,0xE3,0xB1,0xFF,
	0xED,0xD2,0x7F,0xFF,0xEE,0xD3,0x7F,0xFF,0xEF,0xD4,0x83,0xFF,0xEF,0xD4,0x83,0xFF,
	0xEF,0xD4,0x84,0xFF,0xEA,0xCC,0x72,0xFF,0xF7,0xF2,0xE1,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE8,0xD4,0x93,0xFF,0xEF,0xD7,0x82,0xFF,
	0xEF,0xD7,0x85,0xFF,0xEF,0xD7,0x85,0xFF,0xEF,0xD7,0x85,0xFF,0xEE,0xD3,0x78,0xFF,
	0xFC,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFA,0xF7,0xEC,0xFF,
	0xF3,0xE6,0xB6,0xFF,0xEE,0xD4,0x82,0xFF,0xEE,0xD3,0x79,0xFF,0xEE,0xD5,0x7F,0xFF,
	0xEF,0xD7,0x84,0xFF,0xEF,0xD7,0x85,0xFF,0xEF,0xD7,0x85,0xFF,0xEF,0xD7,0x85,0xFF,
	0xEF,0xD8,0x86,0xFF,0xEA,0xCF,0x75,0xFF,0xF8,0xF3,0xE0,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xEA,0xD5,0x95,0xFF,0xF1,0xD7,0x84,0xFF,
	0xF0,0xD7,0x86,0xFF,0xF0,0xD7,0x86,0xFF,0xF0,0xD8,0x86,0xFF,0xEE,0xD4,0x7D,0xFF,
	0xFB,0xFC,0xF8,0xFF,0xF4,0xE8,0xBB,0xFF,0xEF,0xD7,0x87,0xFF,0xEF,0xD4,0x79,0xFF,
	0xF0,0xD5,0x80,0xFF,0xF0,0xD7,0x85,0xFF,0xF0,0xD8,0x86,0xFF,0xF0,0xD7,0x86,0xFF,
	0xF0,0xD7,0x86,0xFF,0xF0,0xD7,0x86,0xFF,0xF0,0xD7,0x86,0xFF,0xF0,0xD7,0x86,0xFF,
	0xF1,0xD8,0x87,0xFF,0xED,0xCF,0x76,0xFF,0xF8,0xF2,0xE1,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xED,0xD9,0x9B,0xFF,0xF3,0xD8,0x89,0xFF,
	0xF4,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,0xF3,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,
	0xF3,0xD7,0x81,0xFF,0xF3,0xD8,0x87,0xFF,0xF3,0xD9,0x8C,0xFF,0xF4,0xDA,0x8D,0xFF,
	0xF4,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,
	0xF4,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,0xF4,0xDA,0x8D,0xFF,
	0xF4,0xDA,0x8E,0xFF,0xEE,0xD2,0x7D,0xFF,0xF8,0xF5,0xE7,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF2,0xE6,0xBD,0xFF,0xF1,0xDA,0x96,0xFF,
	0xF4,0xDD,0x9C,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,
	0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,
	0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,
	0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9D,0xFF,0xF4,0xDD,0x9C,0xFF,
	0xF4,0xDE,0xA0,0xFF,0xEB,0xD3,0x87,0xFF,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFC,0xFE,0xFE,0xFF,0xEB,0xD3,0x83,0xFF,
	0xF7,0xE7,0xBB,0xFF,0xF5,0xE0,0xA6,0xFF,0xF5,0xE1,0xA7,0xFF,0xF5,0xE1,0xA7,0xFF,
	0xF5,0xE1,0xA7,0xFF,0xF5,0xE1,0xA7,0xFF,0xF5,0xE0,0xA7,0xFF,0xF5,0xE0,0xA7,0xFF,
	0xF5,0xE0,0xA7,0xFF,0xF5,0xE0,0xA7,0xFF,0xF5,0xE0,0xA7,0xFF,0xF5,0xE1,0xA7,0xFF,
	0xF5,0xE1,0xA7,0xFF,0xF5,0xE1,0xA7,0xFF,0xF5,0xE0,0xA6,0xFF,0xF5,0xE1,0xA9,0xFF,
	0xF5,0xE7,0xC0,0xFF,0xEF,0xDD,0xA4,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF5,0xEC,0xCF,0xFF,
	0xED,0xD7,0x8F,0xFF,0xFB,0xF0,0xD9,0xFF,0xFA,0xEE,0xD2,0xFF,0xF9,0xEE,0xD1,0xFF,
	0xF9,0xEE,0xD2,0xFF,0xF9,0xEE,0xD2,0xFF,0xFA,0xEE,0xD2,0xFF,0xF9,0xEE,0xD2,0xFF,
	0xF9,0xEE,0xD2,0xFF,0xF9,0xEE,0xD2,0xFF,0xFA,0xEE,0xD2,0xFF,0xF9,0xEE,0xD2,0xFF,
	0xF9,0xEE,0xD2,0xFF,0xF9,0xEE,0xD2,0xFF,0xFA,0xF0,0xD7,0xFF,0xF6,0xEB,0xCA,0xFF,
	0xEB,0xD2,0x81,0xFF,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
	0xF8,0xF5,0xE4,0xFF,0xEE,0xDB,0x97,0xFF,0xEF,0xDA,0x94,0xFF,0xF1,0xDB,0x96,0xFF,
	0xF1,0xDB,0x96,0xFF,0xF1,0xDB,0x96,0xFF,0xF1,0xDB,0x96,0xFF,0xF1,0xDB,0x95,0xFF,
	0xF1,0xDB,0x96,0xFF,0xF1,0xDB,0x95,0xFF,0xF1,0xDB,0x96,0xFF,0xF1,0xDB,0x96,0xFF,
	0xF1,0xDB,0x96,0xFF,0xF1,0xDA,0x95,0xFF,0xEF,0xD9,0x93,0xFF,0xF1,0xE2,0xAE,0xFF,
	0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
};

#ifdef MOUSE_DEMO_ENABLE
static hcfb_scale_t scale_param = {1, 1, 1, 1};//{ 1280, 720, 1920, 1080 };// to do later...
#else
static hcfb_scale_t scale_param = { 1280, 720, 1920, 1080 };// to do later...
#endif
static int screen_size =  0;
static int pixel_bytes =  0;
static long int screensize = 0;
static struct fb_var_screeninfo vinfo;
static struct fb_fix_screeninfo finfo;
static char *fb_p0 = 0;
static char *fb_p1 = 0;
static uint32_t fb_dis_buf[1280*720] = { 0 };
static int fb_fd = 0;
static hcfb_lefttop_pos_t start_pos ={0};
static hcfb_lefttop_pos_t pos = {0};
static uint8_t *bmp_buf = 0;



struct fb_cmap cmap_user = {
	.start = 0,
	.len = 256,
	.red = red_16,
	.green  = green_16,
	.blue = blue_16,
	.transp = alpha_16,
};


/** Represents an area of the screen.*/
typedef struct {
    int16_t x1;
    int16_t y1;
    int16_t x2;
    int16_t y2;
} fb_dis_area_t;

struct dis_rect {
	uint32_t x_start;
	uint32_t x_width;
	uint32_t y_start;
	uint32_t y_hight;
};


/* csc matrix coef */
static int enhance_coef_default_bt709[] = {
	93, 314, 32, 0, -52, -173, 225, 0, 225, -204, -21, 0,
};

static int enhance_coef_default_bt601[] = {
	131, 258, 50, 0, -76, -149, 225, 0, 225, -188, -37, 0,
};

static int bytes_per_pixel (int bits_per_pixel) {
	switch(bits_per_pixel) {
	case 32:
	case 24:
		return 4;
	case 16:
	case 15:
		return 2;
	default:
		return 1;
	}
}
static int cosffn(int x) {
	int neg = 0;
	int index, alpha;
	const int residue_nbit = FRAC_BITS - (ENTRY_BITS + 1);
	int prev, next, val;

	x = x < 0 ? -x : x;

	// fold to [0, 2)*pi
	x &= (2 << FRAC_BITS) - 1;

	// fold to [0..1)*pi
	if (x >= FRAC_ONE)
		x = FRAC_TWO - x;

	// fold x to [0..0.5]*pi
	if (x > FRAC_HALF) {
		x = FRAC_ONE - x;
		neg = 1;
	}

	index = x >> residue_nbit;
	alpha = x & ((1 << residue_nbit) - 1);

	if (index == 0)
		prev = FRAC_ONE;
	else
		prev = cos_lut[index - 1];

	if (index == (1 << ENTRY_BITS))
		next = -cos_lut[index - 2];
	else
		next = cos_lut[index];

	val = (prev * ((1 << residue_nbit) - alpha) + next * alpha + (1 << (residue_nbit - 1))) >> residue_nbit;

	return neg ? -val : val;
}

static int sinffn(int x) {
	return cosffn(FRAC_HALF - x);
}

static void fbdev_calc_scale(void) {
	int disfd = -1;
	struct dis_screen_info screen = { 0 };

	disfd = open("/dev/dis", O_RDWR);
	if (disfd < 0) {
		return;
	}

	screen.distype = DIS_TYPE_HD;
	if(ioctl(disfd, DIS_GET_SCREEN_INFO, &screen)) {
		close(disfd);
		return;
	}

	scale_param.h_mul = screen.area.w;
	scale_param.v_mul = screen.area.h;
	close(disfd);
}

static int set_dis_mem_color(int index) {
	int i = 0;
	int j = 0;
	int16_t* fb_dis_16b = NULL;
	int32_t* fb_dis_32b = NULL;
	int8_t* fb_dis_8b = NULL;
	
	fb_dis_16b = (int16_t*)fb_dis_buf;
	fb_dis_8b = (int8_t*)fb_dis_buf;
	#if 1
	for (j=0;j<FB_HIGTH;j++) {
		for (i=0;i<FB_WIDTH;i++) {
			if (COLOR_BIT == 32) {
				fb_dis_buf[j*FB_WIDTH+i] = 0xffff0000;//red
			}
			else if (COLOR_BIT == 16) {
				fb_dis_16b[j*FB_WIDTH+i] = 0x07e0;
			}
			else if (COLOR_BIT == 8) {
				#if 0
				fb_dis_8b[j*FB_WIDTH+i] = 0xff;
				#else
				fb_dis_8b[j*FB_WIDTH+i] = rand()%256;//index;//rand()%256;
				#endif
			}
		}
	}
	#else
	for(j=0;j<100;j++) {
		for(i=0;i<100;i++) {
			if (COLOR_BIT == 32) {
				fb_dis_buf[j*100+i] = 0xffff0000;
			}
			else if (COLOR_BIT == 16) {
				fb_dis_16b[j*100+i] = 0x07e0;
			}
			else if (COLOR_BIT == 8) {
				#if 0
				fb_dis_8b[j*FB_WIDTH+i] = 0xff;
				#else
				fb_dis_8b[j*FB_WIDTH+i] = rand()%256;//index;//rand()%256;
				#endif
			}
		}
	}
	#endif
	
	return 0;
}

static void ap_dis_bmp(struct dis_rect* dis_rect,uint8_t* buf)
{
	uint32_t i = 0;
	uint32_t j = 0;
	int16_t* fb_dis_16b = NULL;
	int32_t* fb_dis_32b = NULL;
	int8_t* fb_dis_8b = NULL;
	int16_t* fb_src_16b = NULL;
	int32_t* fb_src_32b = NULL;
	int8_t* fb_src_8b = NULL;
	int   ret = 0;
	int src_pos = 0;
	uint32_t x_end = 0;
	uint32_t y_end = 0;

	printf("fb_base=0x%x,y_start=%d,hight=%d,x_start=%d,x_width=%d,xres=%d\n",(unsigned int)fb_dis_buf,\
		(unsigned int)dis_rect->y_start,(unsigned int)dis_rect->y_hight,\
		(unsigned int)dis_rect->x_start,(unsigned int)dis_rect->x_width,(unsigned int)vinfo.xres);
	//return;
	fb_dis_16b = (int16_t*)fb_dis_buf;
	fb_dis_8b = (int8_t*)fb_dis_buf;
	fb_dis_32b = (int32_t*)fb_dis_buf;
	fb_src_16b = (int16_t*)buf;
	fb_src_32b = (int32_t*)buf;
	fb_src_8b = (int8_t*)buf;

	x_end = dis_rect->x_start+dis_rect->x_width;
	if(x_end>vinfo.xres) {
		x_end = vinfo.xres;
	}

	y_end = dis_rect->y_start+dis_rect->y_hight;
	if(y_end>vinfo.yres) {
		y_end = vinfo.yres;
	}
	
	for(j=dis_rect->y_start;j<y_end;j++) {
		for(i=dis_rect->x_start;i<x_end;i++) {
			if (vinfo.bits_per_pixel == 32) {
				fb_dis_32b[j*vinfo.xres+i] = fb_src_32b[src_pos++];
			}
			else if (vinfo.bits_per_pixel == 16) {
				fb_dis_16b[j*vinfo.xres+i] =  fb_src_16b[src_pos++];
			}
			else if (vinfo.bits_per_pixel == 8) {
				fb_dis_8b[j*vinfo.xres+i] = fb_src_8b[src_pos++];
			}
		}
	}

}


static void ap_fill_color(struct dis_rect* dis_rect,uint32_t color)
{
	uint32_t i = 0;
	uint32_t j = 0;
	int16_t* fb_dis_16b = NULL;
	int32_t* fb_dis_32b = NULL;
	int8_t* fb_dis_8b = NULL;
	int   ret = 0;
	uint32_t x_end = 0;
	uint32_t y_end = 0;

	printf("fb_base=0x%x,y_start=%d,hight=%d,x_start=%d,x_width=%d,xres=%d\n",(unsigned int)fb_dis_buf,\
		(unsigned int)dis_rect->y_start,(unsigned int)dis_rect->y_hight,\
		(unsigned int)dis_rect->x_start,(unsigned int)dis_rect->x_width,(unsigned int)vinfo.xres);
	//return;
	fb_dis_16b = (int16_t*)fb_dis_buf;
	fb_dis_8b = (int8_t*)fb_dis_buf;
	fb_dis_32b = (int32_t*)fb_dis_buf;
	x_end = dis_rect->x_start+dis_rect->x_width;
	if(x_end>vinfo.xres) {
		x_end = vinfo.xres;
	}

	y_end = dis_rect->y_start+dis_rect->y_hight;
	if(y_end>vinfo.yres) {
		y_end = vinfo.yres;
	}
	
	for(j=dis_rect->y_start;j<y_end;j++) {
		for(i=dis_rect->x_start;i<x_end;i++) {
			if (vinfo.bits_per_pixel == 32) {
				fb_dis_32b[j*vinfo.xres+i] = color;
			}
			else if (vinfo.bits_per_pixel == 16) {
				fb_dis_16b[j*vinfo.xres+i] = color;
			}
			else if (vinfo.bits_per_pixel == 8) {
				fb_dis_8b[j*vinfo.xres+i] = color;
			}
		}
	}

}


static void fb_flush(fb_dis_area_t* dis_area,uint8_t* color_p) {
	uint32_t* color_32b = NULL;
	uint16_t* color_16b = NULL;
	uint8_t* color_8b = NULL;

		/*Truncate the area to the screen*/
	int32_t act_x1 = dis_area->x1 < 0 ? 0 : dis_area->x1;
	int32_t act_y1 = dis_area->y1 < 0 ? 0 : dis_area->y1;
	int32_t act_x2 = dis_area->x2 > (int32_t)vinfo.xres - 1 ? (int32_t)vinfo.xres - 1 : dis_area->x2;
	int32_t act_y2 = dis_area->y2 > (int32_t)vinfo.yres - 1 ? (int32_t)vinfo.yres - 1 : dis_area->y2;

	int16_t w = (act_x2 - act_x1 + 1);
	long int location = 0;
	long int byte_location = 0;
	unsigned char bit_location = 0;
	
	if(vinfo.bits_per_pixel == 16 && vinfo.green.length == 5) {
		uint16_t * fbp16;
		uint16_t c;
		int32_t y;
		color_16b = color_p;
		/*printf("color_p: %p, w: %d, h: %d \n", color_p, act_x2 - act_x1, act_y2 - act_y1);*/
		for(y = act_y1; y <= act_y2; y++) {
			int i;
			location = (act_x1 + vinfo.xoffset) + (y + vinfo.yoffset) * finfo.line_length / 2;
			fbp16 = (uint16_t *)fb_p0 + location;
			#if 0
			for (i = 0; i < (act_x2 - act_x1 + 1); i++) {
				if (1)
					c = 1 << 15;
				else
					c = 0;
				*fbp16 = c;
				fbp16++;
			}
			#else
			memcpy(fbp16,color_16b,(act_x2 - act_x1 + 1)*2);
			#endif
			color_16b += w;
		}
	} else if(vinfo.bits_per_pixel == 32 || vinfo.bits_per_pixel == 24) {
		uint32_t * fbp32 = (uint32_t *)fb_p0;
		int32_t y;
		color_32b = color_p;
		for(y = act_y1; y <= act_y2; y++) {
			location = (act_x1 + vinfo.xoffset) + (y + vinfo.yoffset) * finfo.line_length / 4;
			memcpy(&fbp32[location], (uint32_t *)color_32b, (act_x2 - act_x1 + 1) * 4);
			color_32b += w;
		}
	}
	/*16 bit per pixel*/
	else if(vinfo.bits_per_pixel == 16) {
		uint16_t * fbp16 = (uint16_t *)fb_p0;
		int32_t y;
		color_16b = color_p;
		for(y = act_y1; y <= act_y2; y++) {
			location = (act_x1 + vinfo.xoffset) + (y + vinfo.yoffset) * finfo.line_length / 2;
			memcpy(&fbp16[location], (uint32_t *)color_16b, (act_x2 - act_x1 + 1) * 2);
			color_16b += w;
		}
	}
	/*8 bit per pixel*/
	else if(vinfo.bits_per_pixel == 8) {
		uint8_t * fbp8 = (uint8_t *)fb_p0;
		int32_t y;
		for(y = act_y1; y <= act_y2; y++) {
			location = (act_x1 + vinfo.xoffset) + (y + vinfo.yoffset) * finfo.line_length;
			memcpy(&fbp8[location], (uint32_t *)color_p, (act_x2 - act_x1 + 1));
			color_p += w;
		}
	}
	/*1 bit per pixel*/
	else if(vinfo.bits_per_pixel == 1) {
		uint8_t * fbp8 = (uint8_t *)fb_p0;
		int32_t x;
		int32_t y;
		for(y = act_y1; y <= act_y2; y++) {
			for(x = act_x1; x <= act_x2; x++) {
				location = (x + vinfo.xoffset) + (y + vinfo.yoffset) * vinfo.xres;
				byte_location = location / 8; /* find the byte we need to change */
				bit_location = location % 8; /* inside the byte found, find the bit we need to change */
				fbp8[byte_location] &= ~(((uint8_t)(1)) << bit_location);
				//fbp8[byte_location] |= ((uint8_t)(color_p->full)) << bit_location;
				color_p++;
			}

			color_p += dis_area->x2 - act_x2;
		}
	} else {
		/*Not supported bit per pixel*/
	}
}

static int fb_test_set_platte_red(int argc , char *argv[])
{
	int index = 0;
	unsigned short red_tmp = 0;
	if (argc > 2)
	{
		index = atoi(argv[1]);
		red_tmp = atoi(argv[2]);
		red_16[index] = red_tmp;
	}
	return 0;
}

static int fb_test_set_platte_blue(int argc , char *argv[])
{
	int index = 0;
	unsigned short blue_tmp = 0;
	if (argc > 2)
	{
		index = atoi(argv[1]);
		blue_tmp = atoi(argv[2]);
		blue_16[index] = blue_tmp;
	}
	return 0;
}

static int fb_test_set_platte_green(int argc , char *argv[])
{
	int index = 0;
	unsigned short green_tmp = 0;
	if (argc > 2)
	{
		index = atoi(argv[1]);
		green_tmp = atoi(argv[2]);
		green_16[index] = green_tmp;
	}
	return 0;
}

static int fb_test_set_fliter (int argc , char *argv[]) {
	int index = 0;
	int green_tmp = 0;
	hcfb_enhance_t enhance_tmp ;
	if (argc > 2)
	{
		if(ioctl(fb_fd, HCFBIOGET_ENHANCE, &enhance_tmp) == -1) {
			perror("Error reading variable enhance_tmp");
			return -1;
		}
		index = atoi(argv[1]);
		green_tmp = atoi(argv[2]);
		enhance_tmp.cscmode = green_tmp;
		ioctl(fb_fd, HCFBIOSET_ENHANCE, &enhance_tmp);
	}
	return 0;
}


static int fb_test_start (int argc , char *argv[]) {
	fb_dis_area_t test_dis_area;
	int index = 0;
	unsigned short red_tmp = 0;
	unsigned short blue_tmp = 0;
	unsigned short green_tmp = 0;
	unsigned short alpha_tmp = 0;
	int i = 0;
	int bit_tmp = 0;
	int fd;
	struct dis_layer_blend_order vhance = { 0 };
	
	if (argc > 4) {
		index = atoi(argv[1]);
		red_tmp = atoi(argv[2]);
		blue_tmp = atoi(argv[3]);
		green_tmp = atoi(argv[4]);
		alpha_tmp = atoi(argv[5]);
		for(i=0;i<256;i++) {
			red_16[i] = red_tmp;
			green_16[i] = green_tmp;
			blue_16[i] = blue_tmp;
			alpha_16[i] = alpha_tmp;
		}
	}
	else if(argc == 2) {
		index = atoi(argv[1]);
	}
	else if(argc == 4) {
		index = atoi(argv[1]);
		alpha_tmp = atoi(argv[2]);
		bit_tmp = atoi(argv[3]);
		for(i=0;i<256;i++) {
			alpha_16[i] = alpha_tmp;
			red_16[i] = (red_16[i]<<bit_tmp);
			green_16[i] = (green_16[i]<<bit_tmp);
			blue_16[i] = (blue_16[i]<<bit_tmp);
		}
		
	}
	#ifdef MOUSE_DEMO_ENABLE
	fd = open("/dev/dis" , O_WRONLY);
	if(fd < 0) {
		return -1;
	}
	vhance.distype = DIS_TYPE_HD;
	vhance.main_layer = 0;
	vhance.auxp_layer = 1;
	vhance.gmaf_layer = 2;
	vhance.gmas_layer = 3;
	ioctl(fd , DIS_SET_LAYER_ORDER , &vhance);

	close(fd);
	#endif
	if(index==0)
		fb_fd = open(FBDEV_PATH, O_RDWR);
	else
		fb_fd = open(FBDEV_PATH2, O_RDWR);
	
	if(fb_fd == -1) {
		perror("Error: cannot open framebuffer device");
		return -1;
	}
	printf("The framebuffer device was opened successfully.\n");

	// Make sure that the display is on.
	if (ioctl(fb_fd, FBIOBLANK, FB_BLANK_UNBLANK) != 0) {
		perror("ioctl(FBIOBLANK)");
		return -1;
	}

	if(ioctl(fb_fd, FBIOGET_VSCREENINFO, &vinfo) == -1) {
		perror("Error reading variable information");
		return -1;
	}

	vinfo.xoffset = 0;
	vinfo.yoffset = 0;
	#ifdef MOUSE_DEMO_ENABLE
	vinfo.yres = 24;
	vinfo.xres = 24;
	#endif
	if (COLOR_BIT==16) {
		vinfo.bits_per_pixel = 16;
		vinfo.red.length = 5;
		vinfo.green.length = 6;
		vinfo.blue.length = 5;
		//vinfo.blue.length = 8;
		vinfo.yres_virtual = vinfo.yres;
	}
	else if (COLOR_BIT==32) {
		vinfo.bits_per_pixel = 32;
		vinfo.red.length = 8;
		vinfo.green.length = 8;
		vinfo.blue.length = 8;
		vinfo.xres_virtual = vinfo.xres;
		vinfo.yres_virtual = vinfo.yres;
	}
	else if(COLOR_BIT==8) {
		vinfo.bits_per_pixel = 8;
		vinfo.red.length = 8;
		vinfo.green.length = 8;
		vinfo.blue.length = 8;
		vinfo.yres_virtual = vinfo.yres ;
	}

	printf("bits_per_pixel: %d,red.length: %d, green.length: %d, blue.length: %d\n",
	       vinfo.bits_per_pixel, vinfo.red.length, vinfo.green.length,
	       vinfo.blue.length);
	vinfo.activate |= FB_ACTIVATE_FORCE|FB_ACTIVATE_NOW;
	printf("cmap_user red=0x%x,green=0x%x,transp=0x%x\n",(unsigned int)cmap_user.red,\
		(unsigned int)cmap_user.green,(unsigned int)cmap_user.transp);
	
	if(ioctl(fb_fd, FBIOPUTCMAP, &cmap_user) == -1) {
		perror("Error set cmap");
		return -1;
	}

	// Get variable screen information
	if(ioctl(fb_fd, FBIOPUT_VSCREENINFO, &vinfo) == -1) {
		perror("Error reading variable information");
		return -1;
	}

	// Get fixed screen information
	if(ioctl(fb_fd, FBIOGET_FSCREENINFO, &finfo) == -1) {
		perror("Error reading fixed information");
		return -1;
	}
	#ifndef MOUSE_DEMO_ENABLE
	fbdev_calc_scale();
	#endif

	if (ioctl(fb_fd, HCFBIOSET_SCALE, &scale_param) != 0) {
		perror("ioctl(set scale param)");
		return -1;
	}
	// Figure out the size of the screen in bytes
	screensize =  finfo.smem_len; //finfo.line_length * vinfo.yres;

	ioctl(fb_fd, HCFBIOSET_MMAP_CACHE, HCFB_MMAP_NO_CACHE);

	// Map the device to memory
	fb_p0 = (char *)mmap(0, screensize, PROT_READ | PROT_WRITE, MAP_SHARED, fb_fd, 0);
	if((intptr_t)fb_p0 == -1) {
		perror("Error: failed to map framebuffer device to memory");
		return;
	}
	memset(fb_p0, 0, screensize);

	pixel_bytes = bytes_per_pixel(vinfo.bits_per_pixel);
	screen_size = vinfo.xres * vinfo.yres * pixel_bytes;
	printf("pixel_bytes: %d, screen_size: %08x,fb_p0 = 0x%x,fb_dis_buf=0x%x\n", pixel_bytes, screen_size,fb_p0,fb_dis_buf);
	printf("The framebuffer device was mapped to memory successfully.\n");
	
	#ifdef MOUSE_DEMO_ENABLE
	test_dis_area.x1 = 0;
	test_dis_area.x2 = 24;
	test_dis_area.y1 = 0;
	test_dis_area.y2 = 24;
	#else
	test_dis_area.x1 = 0;
	test_dis_area.x2 = 1280;
	test_dis_area.y1 = 0;
	test_dis_area.y2 = 720;
	#endif
	set_dis_mem_color(index);
	fb_flush(&test_dis_area,(uint8_t*)fb_dis_buf);
	return 0;
}


static int fb_test_stop (int argc , char *argv[]) {
	close(fb_fd);
	return 0;
}

static void fb_gen_genc (int argc , char *argv[]) {
	int i;
	float my0, my1, my2, my3;
	float Ly, Sy, Sc;
	float tmp1, tmp2, tmp3, tmp4, tmp5, tmp6, tmp7, tmp8, tmp9;
	int sin = 0, cos = 0;
	int hue_in = 0;
	float fval;
	float hue_dou;
	int brightness, contrast, saturation, hue, sharpness;
	hcfb_enhance_cscmode_e csc_mode;
	int coef[13]={0};
	int *f = NULL;
	int opt;
	float hue_dou_tmp = 0;

	#if 0
	while((opt = getopt(argc , argv , "b:c:s:S:h:C")) != EOF)
    {
        switch(opt)
        {
            case 'b':
                brightness = atoi(optarg);
                break;
            case 'c':
                contrast = atoi(optarg);
                break;
			
            case 's':
                saturation = atoi(optarg);
                break;
			case 'h':
				hue = atoi(optarg);
				break;
			case 'S':
				sharpness = atoi(optarg);
				break;
			case 'C':
				csc_mode = atoi(optarg);
				break;
            default:
				brightness = 50;
				contrast = 50;
				saturation = 50;
				hue = 50;
				csc_mode = HCFB_ENHANCE_CSCMODE_BT709;
                break;
        }
    }
	#else
	if(argc>=6)
	{
		brightness = atoi(argv[1]);
		contrast = atoi(argv[2]);
		saturation = atoi(argv[3]);
		hue = atoi(argv[4]);
		sharpness = atoi(argv[5]);
		csc_mode = HCFB_ENHANCE_CSCMODE_BT709;
	}
	else
	{
		brightness = 50;
		contrast = 50;
		saturation = 50;
		hue = 50;
		sharpness = 5;
		csc_mode = HCFB_ENHANCE_CSCMODE_BT709;
	}
	printf("brightness = %d\n",brightness);
	printf("contrast = %d\n",contrast);
	printf("saturation = %d\n",saturation);
	printf("hue = %d\n",hue);
	printf("sharpness = %d\n",sharpness);
	#endif
	if ((brightness == 50) && (contrast == 50) && (saturation == 50) &&
	    (hue == 50)) {
		if (csc_mode == HCFB_ENHANCE_CSCMODE_BT601) {
			for (i = 0; i < 12; i++)
				coef[i] = enhance_coef_default_bt601[i];
		} else {
			for (i = 0; i < 12; i++)
				coef[i] = enhance_coef_default_bt709[i];
		}
	} else {
		/* brightness, contrast, saturation value to float*/
		Ly = ((float)brightness - 50) * 64 / 50;

		/* Sy replace Sr, Sg, Sr : [0, 2] */
		if (contrast >= 50) {
			Sy = 1 + ((float)contrast - 50) / 50;
		} else {
			//Sy = -2 + ((float)contrast) * 3 / 50;
			Sy = ((float)contrast) / 50;
		}

		/* Sc : [0, 2] */
		if (saturation >= 50) {
			Sc = 1 + ((float)saturation - 50) / 50;
		} else {
			//Sc = -2 + ((float)saturation) * 3 / 50;
			Sc = ((float)saturation) / 50;
		}

		Ly = Ly + (1 - Sy) * 64;

		/* sin and cos value for hue */
		if (hue == 50) {
			sin = 0;
			cos = FRAC_ONE;
		} else if ((hue == 100) || (hue == 0)) {
			sin = 0;
			cos = INT_TO_FRAC(-1);
		} else {
			hue_in = 0;
			fval = hue;
			f = (int*)(&fval);
			printf("1.fval = 0x%x\n",*f);
			hue_dou = (fval / 50.0f) - 1.0f;
			//printf("3.div = 0x%x\n",(fval / 50.0f));
			f = (int*)(&hue_dou);
			printf("2.hue_dou = 0x%x\n",*f);
			hue_in = DOUBLE_TO_FRAC(hue_dou);
			hue_dou_tmp = hue_dou*FRAC_ONE;
			f = (int*)(&hue_dou_tmp);
			printf("15.hue_mub = 0x%x\n",*f);
			printf("4.hue_in = 0x%x\n",hue_in);
			sin = sinffn(hue_in);
			cos = cosffn(hue_in);
		}

		tmp1 = Sc * MC0_1;
		f = (int*)(&tmp1);
		printf("5.tmp1 = 0x%x\n",*f);
		tmp2 = Sc * MC0_2;
		f = (int*)(&tmp2);
		printf("6.tmp2 = 0x%x\n",*f);
		tmp3 = Sc * MC1_1;
		f = (int*)(&tmp3);
		printf("7.tmp3 = 0x%x\n",*f);
		tmp4 = Sc * MC1_2;
		f = (int*)(&tmp4);
		printf("8.tmp4 = 0x%x\n",*f);
		tmp5 = Sc * MC2_1;
		f = (int*)(&tmp5);
		printf("9.tmp5 = 0x%x\n",*f);
		tmp6 = Sc * MC2_2;
		f = (int*)(&tmp6);
		printf("10.tmp6 = 0x%x\n",*f);

		my0 = Sy * MY0;
		f = (int*)(&my0);
		printf("11.my0 = 0x%x\n",*f);
		my1 = Sy * MY1;
		f = (int*)(&my1);
		printf("12.my1 = 0x%x\n",*f);
		my2 = Sy * MY2;
		f = (int*)(&my2);
		printf("13.my2 = 0x%x\n",*f);
		my3 = Ly * MY3;
		f = (int*)(&my3);
		printf("14.my3 = 0x%x\n",*f);

		/* generate coef table */
		hue_dou_tmp = my0 + 0.5f;
		f = (int*)(&hue_dou_tmp);
		printf("16.my0 1 = 0x%x\n",*f);
		coef[0] = (int)(my0 + 0.5f);
		coef[1] = (int)(my1 + 0.5f);
		coef[2] = (int)(my2 + 0.5f);
		coef[3] = (int)(my3 + 0.5f);

		tmp7 = -tmp1 * cos + tmp2 * sin;
		tmp8 = -tmp3 * cos - tmp4 * sin;
		tmp9 = tmp5 * cos - tmp6 * sin;

		coef[4] = FLOOR(tmp7 * Sy) >> FRAC_BITS;
		coef[5] = FLOOR(tmp8 * Sy) >> FRAC_BITS;
		coef[6] = FLOOR(tmp9 * Sy) >> FRAC_BITS;
		coef[7] = FLOOR((tmp7 + tmp8 + tmp9) * Ly) >> FRAC_BITS;

		tmp7 = tmp1 * sin + tmp2 * cos;
		tmp8 = tmp3 * sin - tmp4 * cos;
		tmp9 = -tmp5 * sin - tmp6 * cos;
		coef[8] = FLOOR(tmp7 * Sy) >> FRAC_BITS;
		coef[9] = FLOOR(tmp8 * Sy) >> FRAC_BITS;
		coef[10] = FLOOR(tmp9 * Sy) >> FRAC_BITS;
		coef[11] = FLOOR((tmp7 + tmp8 + tmp9) * Ly) >> FRAC_BITS;
	}
	
	sharpness = sharpness - 5;

	if (sharpness > 5) {
		sharpness = 5;
	} else if (sharpness < -5) {
		sharpness = -5;
	}
	sharpness = sharpness & 0x0000000f;

	coef[12] = sharpness;
	for (i=0; i<13; i++) {
		printf("coef[%d]=0x%x\n",i,coef[i]);
	}
}

static int fb_set_scale_pos (int argc , char *argv[]) {
	fb_dis_area_t test_dis_area;

	if (argc >= 3) {
		start_pos.left = (unsigned short)atoi(argv[1]);
		start_pos.top = (unsigned short)atoi(argv[2]);
	}
	printf("start_pos left=%d,top=%d\n",start_pos.left,start_pos.top);
	scale_param.h_mul = 1280;
	scale_param.v_mul = 720;
	
	if (ioctl(fb_fd, HCFBIOSET_SET_LEFTTOP_POS, &start_pos) != 0) {
			printf("ioctl(set scale param)");
			return -1;
	}
	if (ioctl(fb_fd, HCFBIOSET_SCALE, &scale_param) != 0) {
			printf("ioctl(set scale param)");
			return -1;
	}

	test_dis_area.x1 = 0;
	test_dis_area.x2 = 1280;
	test_dis_area.y1 = 0;
	test_dis_area.y2 = 720;
	set_dis_mem_color(0);
	fb_flush(&test_dis_area,(uint8_t*)fb_dis_buf);
	printf("[%s][%d]\n",__FUNCTION__,__LINE__);
	return 0;
}

static int fb_dis_bmp(int argc , char *argv[])
{
	static int bmp_pos = 0;
	struct dis_rect show_rect;
	uint32_t dis_color = 0xffffffff;
	fb_dis_area_t test_dis_area;
	
	if (argc > 1) {
		show_rect.x_start = atoi(argv[1]);
		show_rect.x_width = atoi(argv[2]);
		show_rect.y_start = atoi(argv[3]);
		show_rect.y_hight = atoi(argv[4]);
		dis_color = atoi(argv[5]);
	} else {
		show_rect.x_start = 0;
		show_rect.x_width = 24;
		show_rect.y_start = 0;
		show_rect.y_hight = 24;
	}
	
	pos.left = 0;
	pos.top = 0;
	
	
	if (ioctl(fb_fd, HCFBIOSET_SET_LEFTTOP_POS, &pos) != 0) {
			printf("ioctl(set scale param)");
			return -1;
	}
	
	show_rect.x_start = 0;
	show_rect.x_width = 24;
	show_rect.y_start = 0;
	show_rect.y_hight = 24;
	bmp_buf = bmp_array;
	ap_dis_bmp(&show_rect,bmp_buf);
	test_dis_area.x1 = 0;
	test_dis_area.x2 = 24;
	test_dis_area.y1 = 0;
	test_dis_area.y2 = 24;
	fb_flush(&test_dis_area,(uint8_t*)fb_dis_buf);
	return 0;
}


static int fb_dis_bmp_move(int argc , char *argv[])
{
	static int bmp_pos = 0;
	struct dis_rect show_rect;
	uint32_t dis_color = 0xffffffff;
	
	
	if (argc > 1) {
		pos.left = atoi(argv[1]);
		pos.top = atoi(argv[2]);
	} else {
		show_rect.x_start = 0;
		show_rect.x_width = 24;
		show_rect.y_start = 0;
		show_rect.y_hight = 24;
	}	
	
	if (ioctl(fb_fd, HCFBIOSET_SET_LEFTTOP_POS, &pos) != 0) {
			printf("ioctl(set scale param)");
			return -1;
	}
	
    if (ioctl(fb_fd, FBIOPAN_DISPLAY, &vinfo) < 0) {
        perror("ioctl() / FBIOPAN_DISPLAY");
		return -1;
    }

	return 0;
}




static void exit_console (int signo) {
    (void)signo;
    tcsetattr(0 , TCSANOW , &stored_settings);
    exit(0);
}

int main (int argc , char *argv[]) {
	struct termios new_settings;

    tcgetattr(0 , &stored_settings);
    new_settings = stored_settings;
    new_settings.c_lflag &= ~(ICANON | ECHO | ISIG);
    new_settings.c_cc[VTIME] = 0;
    new_settings.c_cc[VMIN] = 1;
    tcsetattr(0 , TCSANOW , &new_settings);

    signal(SIGTERM , exit_console);
    signal(SIGINT , exit_console);
    signal(SIGSEGV , exit_console);
    signal(SIGBUS , exit_console);
    console_init("hcfb:");

    console_register_cmd(NULL , "start" , fb_test_start , CONSOLE_CMD_MODE_SELF , "start ");
	console_register_cmd(NULL , "genc" , fb_gen_genc , CONSOLE_CMD_MODE_SELF , "genc ");
    console_register_cmd(NULL , "stop" , fb_test_stop , CONSOLE_CMD_MODE_SELF , "stop");
	console_register_cmd(NULL , "set_pr" , fb_test_set_platte_red , CONSOLE_CMD_MODE_SELF , "set_pr");
	console_register_cmd(NULL , "set_pb" , fb_test_set_platte_blue , CONSOLE_CMD_MODE_SELF , "set_pr");
	console_register_cmd(NULL , "set_pg" , fb_test_set_platte_green , CONSOLE_CMD_MODE_SELF , "set_pr");
	console_register_cmd(NULL , "set_scale" , fb_set_scale_pos , CONSOLE_CMD_MODE_SELF , "set_scale");
	console_register_cmd(NULL , "dis_bmp" , fb_dis_bmp , CONSOLE_CMD_MODE_SELF , "dis_bmp");
	console_register_cmd(NULL , "move_bmp" , fb_dis_bmp_move , CONSOLE_CMD_MODE_SELF , "move_bmp");
	
    console_start();
    exit_console(0);
    (void)argc;
    (void)argv;
    return 0;
}

